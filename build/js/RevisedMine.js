var mine={mineA:{},mineTag:{length:0},mineNumber:{},mineTemp:{length:0},mineNum:null,flag:!0,init:function(e,t,n){this.initialize(e,t,n),this.cancel()},initialize:function(e,t,n){var a=e,i=t,r=n,m=document.getElementsByClassName("show")[0];this.mineA=this.creatMine(a,i,n),this.render(m,a,i),this.mineNumber=this.renderdata(this.mineA,i,a),this.event(m,this.mineNumber,a,i,this.mineA,r),this.renderNumber("n",r),this.renderNumber("t","000"),document.getElementById("start").className="",mine.flag||(clearInterval(mine.mineNum),mine.flag=!0,mine.mineNum=null)},cancel:function(){document.oncontextmenu=function(e){var t,n=e||window.event;(t=n).preventDefault?t.preventDefault():t.returnValue=!1}},creatArr:function(e){for(var t=[],n=0;n<e;n++)t.push(n);return t},scort:function(e){return e.sort(function(){return Math.random(1)-.5}),e},random:function(e){return Math.floor(Math.random(1)*e)},creatMine:function(e,t,n){obj={};var a=!0,i=0,r=this.creatArr(t),m=this.creatArr(e);for(this.scort(r),this.scort(m);a;){var s=this.random(t),c=this.random(e),l=r[s]+"-"+m[c];i<n?obj[l]||(obj[l]=-1,i++,obj.length=i):a=!1}return obj},timer:function(){var e,t=(e=0,function(){return++e});return setInterval(function(){var e=t();mine.renderNumber("t",e)},1e3)},renderNumber:function(e,t){for(var n=t+"",a=n.length,i=a;i;i--)1==a&&r(e+1,0),a<4&&r(e+(a-i),n[i-1]);function r(e,t){document.getElementsByClassName(e)[0].className=e+" c"+t}},render:function(e,t,n){e.innerHTML="",e.setAttribute("style","width:"+20*t+"px;");var a="<ul>";for(i=0;i<n;i++)for(j=0;j<t;j++)a+="<li id ='"+i+"-"+j+"'></li>";a+="</ul>",e.innerHTML=a},renderdata:function(e,t,n){for(var a="",i={},r=0;r<t;r++)for(var m=0;m<n;m++)e[a=r+"-"+m]||(i[a]=s(a,e,n,t));return i;function s(e,t,n,a){for(var i,r=e.split("-"),m=parseInt(r[0]),s=parseInt(r[1]),c=n-1,l=a-1,u=0,o=(document.getElementById(e),-1);o<2;o++)if(!((i=m+o)<0||l<i))for(var d=-1;d<2;d++)tempy=s+d,tempy<0||tempy>c||0==o&&0==d||t[i+"-"+tempy]&&u++;return u}},event:function(c,y,e,t,r,m){var s=0,l=0,u=0,o=0,g=e,d=t;function n(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attchEvent?e.attchEvent("on"+t,function(){n.call(e)}):e["on"+t]=n}function v(e,t){var r=function(e,t,n){for(var a,i,r=e.split("-"),m=parseInt(r[0]),s=parseInt(r[1]),c=g-1,l=n-1,u={length:0},o=-1;o<2;o++)if(!((a=m+o)<0||l<a))for(var d=-1;d<2;d++)if(tempy=s+d,!(tempy<0||tempy>c||0==o&&0==d)){i=a+"-"+tempy;var v=document.getElementById(i),f=v.getAttribute("tempSign");u[i]||((""==v.className||f)&&(u[i]=1),"ctag"==v.className&&u.length++)}return u}(e,0,d),m=y[e];t?function(e){for(var t in delete r.length,r){var n=document.getElementById(t);n.className&&(n.className=""),n.removeAttribute("tempSign")}}():function(e){var t=document.getElementById(e).className;if(m!=r.length)for(var n in delete r.length,r){var a=document.getElementById(n);a.className="ce",a.setAttribute("tempSign","1")}else for(var n in delete r.length,r){var a=document.getElementById(n),i=y[n];void 0!==i?""==t?(a.className="ce",a.setAttribute("tempSign","1")):(a.className="c"+i,0==i&&f(n,0),mine.gameOver()):f(n,0)}}(e)}function f(e,t,i){var n=document.getElementById(e);2==t?mineTag=function(e,t){var n=t.className;""==n?t.className="ctag":"ctag"==n?t.className="cun":"cun"==n&&(t.className="");var a=i-c.getElementsByClassName("ctag").length;return mine.renderNumber("n",a),a}(0,n):function(e,t){var n=y[e];if("ctag"!=t.className)if(void 0===n){t.className="cerr",function(e){var t={},n=c.getElementsByClassName("ctag"),a=n.length,i=null,r=null;t=mine.clone(e);for(var m=0;m<a;m++)null!=n[m]&&(r=n[m].id,t[r]?delete t[r]:n[m].className="cno");for(var s in t.length&&delete t.length,t)"cerr"!=(i=document.getElementById(s)).className&&(i.className="cm")}(r),mine.flag||(clearInterval(mine.mineNum),mine.flag=!0,mine.mineNum=null);var a=document.getElementById("start");a.className="cry"}else t.className="c"+n,0==n&&function e(t,n,a){var i=document.getElementById(t),r=i.getAttribute("iSign");var m,s,c=t.split("-"),l=parseInt(c[0]),u=parseInt(c[1]),o=n-1,d=a-1;if(l-d==1||u-o==1||2==r)return!1;for(var v=-1;v<2;v++)if(!((m=l+v)<0||d<m))for(var f=-1;f<2;f++)if(tempy=u+f,!(tempy<0||tempy>o||0==v&&0==f)){s=m+"-"+tempy;var g=document.getElementById(s),N=y[s],h=g.getAttribute("iSign");""==g.className?void 0!==N&&(g.className="c"+N,0==N&&2!=h&&e(s,n,a)):0==N&&2!=h&&(g.setAttribute("iSign",2),e(s,n,a))}}(e,g,d),mine.flag&&(mine.mineNum=mine.timer(),mine.flag=!1);this.mine.gameOver()}(e,n)}n(c=c.getElementsByTagName("ul")[0],"mousedown",function(e){var t=e||window.event,n=(t.target||t.srcElement).id,a=t.button;if(a%2==0){2==a?s=Date.now():l=Date.now();var i=setTimeout(function(){var e=Math.abs(s-l);e<60?(0==a&&(v(n),!0),clearTimeout(i)):(f(n,a,m),!1)},60)}}),n(c,"mouseup",function(e){var t=e||window.event,n=(t.target||t.srcElement).id,a=t.button;if(a%2==0){2==a?u=Date.now():o=Date.now();var i=setTimeout(function(){var e=Math.abs(u-o);e<=60?(0==a&&(v(n,"up"),!1),clearTimeout(i)):v(n,"up")},60)}})},clone:function(e,t){for(var n in t=t||{},e)t[n]=e[n];return t},gameOver:function(){var e={},t=0;for(var n in e=this.clone(this.mineNumber)){var a=document.getElementById(n),i="c"+e[n];a.className==i?delete e[n]:t++}!t&&this.readerMine()},readerMine:function(){var e=this.clone(this.mineA);for(var t in delete e.length,e){var n=document.getElementById(t);n.className;""==n.className&&(n.className="ctag")}mine.renderNumber("n",0),mine.flag||(clearInterval(mine.mineNum),mine.flag=!0,mine.mineNum=null)}},game={init:function(){mine.init(9,9,10),this.mineLevel(),this.start()},mineLevel:function(){document.getElementsByClassName("button")[0].getElementsByTagName("ul")[0].addEventListener("click",event,!1)},start:function(){document.getElementById("start").addEventListener("click",begin,!1)}};function begin(e){switch(document.getElementsByClassName("active")[0].id){case"easy":mine.init(9,9,10);break;case"middle":mine.init(16,16,40);break;case"hard":mine.init(30,16,99)}document.getElementById("start").className=""}function event(e){var t=e||window.event,n=t.target||t.srcElement,a=document.getElementsByClassName("active")[0];switch(n.id){case"easy":mine.init(9,9,10),a.className="",n.className="active";break;case"middle":mine.init(16,16,40),a.className="",n.className="active";break;case"hard":mine.init(30,16,99),a.className="",n.className="active"}}game.init();